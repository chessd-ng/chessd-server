This document assumes that the reader is familiar with the XMPP protocol (http://www.xmpp.org/).
The protocol described here is in development and will suffer changes in the future that
may my break compatibility with previous versions.

<!--
     First thing to do is to send a presence to the match component.
     Note: the field to depends on the server configuration.
-->
<presence to='match.shiva'/>

<!--
    Now you can offer a match to somone who is available to play.
    Currently supported categories are standard, blitz and lightning.
-->
<iq type='set' to='match.shiva' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#match#offer'>
		<match category='standard'>
            <player jid='raphaelhr@shiva/Psi' time='900' inc='1' color='white'/>
            <player jid='eduari@shiva/Psi' time='900' inc='1' color='black'/>
        </match>
    </query>
</iq>

<!--
    The server will acknowledge your request with an iq result.
    The offer is identified by the given id.
-->
<iq type='result' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#match#offer'>
        <match id='0'/>
    </query>
</iq>

<!--
    The other player will receive a notification of the offer.
-->
<iq from="match.shiva" type="set" id="1" to="eduari@shiva/Psi" >
    <query xmlns='http://c3sl.ufpr.br/chessd#match#offer'/>
        <match category="standard" id="0" >
            <player inc="1" color="white" time="900" jid="raphaelhr@shiva/Psi" />
            <player inc="1" color="black" time="900" jid="eduari@shiva/Psi" />
        </match>
    </query>
</iq>

<!--
    In order to accept the offer, the player must send
    an iq to the server with the offer's id.
-->
<iq type='set' to='match.shiva' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#match#accept'>
        <match id="0"/>
    </query>
</iq>

<!--
    The user can decline the offer by sending the follwing message.
    Note that both users, the one who offered and the one who received the offer,
    can send this message and the effect is the same, the offer is canceled.
-->
<iq type='set' to='match.shiva' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#match#decline'>
        <match id="0"/>
    </query>
</iq>

<!--
    When the offer is accepted, the players involved will receive
    a notification with the offer's id and the game room where
    the game started.
-->
<iq type='set' from='match.shiva' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#match#decline/accept'>
        <match id="0" room="game_0@games.shiva"/>
    </query>
</iq>

<!--
    To change the paramenters of a offer, one of the players
    could send a reoffer, which is the same of a offer but
    it carries the offer's id being replaced.
-->
<iq type='set' to='match.shiva' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#match#offer'>
        <match category='standard' id='0'>
            <player jid='raphaelhr@shiva/Psi' time='1000' inc='2' color='white'/>
            <player jid='eduari@shiva/Psi' time='1000' inc='2' color='black'/>
        </match>
    </query>
</iq>

<!--
    The game room work just like Muc extension.
    The players must join the room before start playing.
-->
<presence to='game_0@games.shiva/raphaelhr'/>

<!--
    When a player joins a game he will receive the current game state.
-->
<iq from="game_0@games.shiva" type="set" id="0" to="raphaelhr@shiva/Psi" >
    <query xmlns="http://c3sl.ufpr.br/chessd#game#state">
        <state category="standard" >
            <board fullmoves="1" enpassant="-" castle="KQkq" halfmoves="0" state="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR" turn="w" />
            <player inc="1" color="white" time="900" jid="raphaelhr@shiva/Psi" />
            <player inc="1" color="black" time="900" jid="eduari@shiva/Psi" />
        </state>
    </query>
</iq>

<!--
    A player can issue a move sending the following message
-->
<iq type='set' to='game_0@games.shiva' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#game#move'>
        <move long='e2e4'/>
    </query>
</iq>

<iq type='set' to='game_0@games.shiva' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#game#move'>
        <move long='e7e5'/>
    </query>
</iq>

<!-- 
    If the move is invalid the player will receive an iq error.
-->

<!--
    For each move in the game, the players in the room will receive
    a notification of the move
-->
<iq from="game_0@games.shiva" type="set" id="0" to="raphaelhr@shiva/Psi" >
    <query xmlns="http://c3sl.ufpr.br/chessd#game#state">
        <state category="standard" >
        <move long='e2e4'>
            <board fullmoves="1" enpassant="-" castle="KQkq" halfmoves="0" state="rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR" turn="w" />
            <player inc="1" color="white" time="900" jid="raphaelhr@shiva/Psi" />
            <player inc="1" color="black" time="900" jid="eduari@shiva/Psi" />
        </state>
    </query>
</iq>

<!--
    A player can resign, offer draw/cancel/adjourn using the floowing message.
    The diference is just the xmlns.
-->
<iq type='set' to='game_0@games.shiva' id='draw'>
    <query xmlns='http://c3sl.ufpr.br/chessd#game#resign/draw/cancel/adjourn'/>
</iq>

<!--
    The players will be notified of the offer.
-->
<iq type='set' from='game_0@games.shiva' id='draw'>
    <query xmlns='http://c3sl.ufpr.br/chessd#game#draw/cancel/adjourn'/>
</iq>

<!-- 
     The players can accept the offer sending the same message of the offer.
     Or decline it by sending the same message with a "-decline" sufix
     in the xmlns.
-->

<!--
    When the game is over, the players will be notified of the result.
-->
<iq from="game_0@games.shiva" type="set" id="2" to="eduari@shiva/Psi" >
    <query xmlns="http://c3sl.ufpr.br/chessd#game#end">
        <reason>The other player resigned</reason>
        <player result="winner" jid="raphaelhr@shiva/Psi" />
        <player result="loser" jid="eduari@shiva/Psi" />
    </query>
</iq>

<!--
    After the game is over, the players may leve the room.
     do jogo
-->
<presence to='game_0@games.shiva/raphaelhr' type='unavailable'/>

<!--
      To request users info one should send the following message.
      Only rating and type is supported.
-->
<iq type='set' to='rating.shiva' id='get_rating'>
    <query xmlns='http://c3sl.ufpr.br/chessd#info'>
        <rating jid='raphaelhr@shiva' category='standard'/>
        <rating jid='eduari@shiva' category='standard'/>
        <type jid='eduari@shiva'/>
        <type jid='raphaelhr@shiva'/>
    </query>
</iq>

<!--
    The answer will be like this.
-->
<iq from="rating.shiva" type="result" id="get_rating" to="eduari@shiva/Psi" >
    <query xmlns="http://c3sl.ufpr.br/chessd#rating">
        <rating losses="0" category="standard" wins="11" draws="0" rating="1847" jid="raphaelhr@shiva" />
        <rating losses="11" category="standard" wins="0" draws="0" rating="1153" jid="eduari@shiva" />
        <type jid='eduari@shiva' type='admin'/>
        <type jid='raphaelhr@shiva' type='robot'/>
    </query>
</iq>
