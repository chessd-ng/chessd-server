<!--
     Primeiro mande uma msg apara o component de desafio dizendo
     que você está disponível para jogos.
-->
<presence to='match.shiva'/>

<!--
     Agora você pode pedir um desafio no seguinte formato.
     Nota, o tempo é em segundos.
-->
<iq type='set' to='match.shiva' id='match'>
	<query xmlns='http://c3sl.ufpr.br/chessd#match#offer'>
		<match category='standard'>
            <player jid='raphaelhr@shiva/Psi' time='900' inc='1' color='w'/>
            <player jid='eduari@shiva/Psi' time='900' inc='1' color='b'/>
        </match>
	</query>
</iq>

<!--
     Se tudo der certo você receberá uma resposta com o id do desafio
     caso contrário, receberá uma respsta de erro.
-->
<iq type='result' id='match'>
    <query xmlns='http://c3sl.ufpr.br/chessd#match#offer'>
        <match id='0'/>
    </query>
</iq>

<!--
     O desafiado receberá um aviso do
     servidor com as informações do desafio.
     Note o campo id na tag match que
     idenfica o desafio.
-->
<iq from="match.shiva" type="set" id="1" to="eduari@shiva/Psi" >
    <query xmlns='http://c3sl.ufpr.br/chessd#match#offer'/>
        <match category="standard" id="0" >
            <player inc="1" color="w" time="900" jid="raphaelhr@shiva/Psi" />
            <player inc="1" color="b" time="900" jid="eduari@shiva/Psi" />
        </match>
    </query>
</iq>

<!--
      Para o desafiado aceitar a partida, deverá enviar
      a seguinte mensagem, note que o campo id idenfica
      qual desafio está sendo aceito.
-->
<iq type='set' to='match.shiva' id='match'>
	<query xmlns='http://c3sl.ufpr.br/chessd#match#accept'>
        <match id="0" room="room_name@games.shiva"/>
    </query>
</iq>

<!--
      O desafido pode ser recusado mandando a seguinte mensagem.
      O desafiador também pode enviar essa mensagem caso
      ele desista do desafio.
-->
<iq type='set' to='match.shiva' id='match'>
	<query xmlns='http://c3sl.ufpr.br/chessd#match#decline'>
        <match id="0"/>
    </query>
</iq>

<!--
     Quando o desafio for aceito ou recusado, todas
     as partes envolvidas no desafio serão avisadas
     do resultado.
-->
<iq type='set' from='match.shiva' id='match'>
	<query xmlns='http://c3sl.ufpr.br/chessd#match#decline/accept'>
        <match id="0"/>
    </query>
</iq>

<!--
     Então as partes deverão entrar na sala
-->
<presence to='game_0@games.shiva/raphaelhr'/>

<!--
     Ao entrar na sala o jogador receberá o estado
     da partida
-->
<iq from="game_0@games.shiva" type="set" id="0" to="raphaelhr@shiva/Psi" >
    <query xmlns="http://c3sl.ufpr.br/chessd#game#state">
        <state category="standard" >
			<board fullmoves="1" enpassant="-" castle="KQkq" halfmoves="0" state="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR" turn="w" />
            <player inc="1" color="w" time="900" jid="raphaelhr@shiva/Psi" />
            <player inc="1" color="b" time="900" jid="eduari@shiva/Psi" />
        </state>
    </query>
</iq>

<!--
     O jogador pode fazer um movimento com a seguinte mensagem
-->
<iq type='set' to='game_0@games.shiva' id='match'>
	<query xmlns='http://c3sl.ufpr.br/chessd#game#move'>
        <move long='e2e4'/>
    </query>
</iq>

<iq type='set' to='game_0@games.shiva' id='match'>
	<query xmlns='http://c3sl.ufpr.br/chessd#game#move'>
        <move long='e7e5'/>
    </query>
</iq>

<!-- 
     Se a jogada for inválida, o jogador receberá
     um iq de erro, caso contrário receberá um result vazio
-->

<!--
     A cada jogada realizada todos os jogadores presentes
     receberão o novo estado do jogo
-->

<!--
     Um jogador pode desisitir, pedir empate/cancelamento/adjourn
     com a seguinte msg
-->
<iq type='set' to='game_0@games.shiva' id='draw'>
	<query xmlns='http://c3sl.ufpr.br/chessd#game#resign/draw/cancel/adjourn'/>
</iq>

<!--
     Os jogadores serão avisados.
-->
<iq type='set' from='game_0@games.shiva' id='draw'>
	<query xmlns='http://c3sl.ufpr.br/chessd#game#draw/cancel/adjourn'/>
</iq>

<!-- 
     Os jogadores poderão aceitar mandando a mesma msg de requisição
     ou recusar mandando a mesma mensagem só que com o sufixo "-decline"
     no xlmns.
-->

<!--
     Ao final do jogo os jogadores serão notificados
     do resultado.
-->
<iq from="game_0@games.shiva" type="set" id="2" to="eduari@shiva/Psi" >
    <query xmlns="http://c3sl.ufpr.br/chessd#game#end">
        <reason>The other player resigned</reason>
        <player result="winner" jid="raphaelhr@shiva/Psi" />
        <player result="loser" jid="eduari@shiva/Psi" />
    </query>
</iq>

<!--
     Os jogadores poderão deixar a sala de jogo ao final
     do jogo
-->
<presence to='game_0@games.shiva/raphaelhr' type='unavailable'/>

<!--
      Para saber o informações de um ou mais jogadores
      a seguinte msg deverá ser enviada
-->
<iq type='set' to='rating.shiva' id='get_rating'>
    <query xmlns='http://c3sl.ufpr.br/chessd#info'>
        <rating jid='raphaelhr@shiva' category='standard'/>
        <rating jid='eduari@shiva' category='standard'/>
        <type jid='eduari@shiva'/>
        <type jid='raphaelhr@shiva'/>
    </query>
</iq>

<!--
     A resposta será
-->
<iq from="rating.shiva" type="result" id="get_rating" to="eduari@shiva/Psi" >
    <query xmlns="http://c3sl.ufpr.br/chessd#rating">
        <rating losses="0" category="standard" wins="11" draws="0" rating="1847" jid="raphaelhr@shiva" />
        <rating losses="11" category="standard" wins="0" draws="0" rating="1153" jid="eduari@shiva" />
    </query>
</iq>
